{
  "swagger": "2.0",
  "info": {
    "title": "API",
    "description": "Totoro API Information",
    "version": "1.0"
  },
  "securityDefinitions": {
    "ApiKeyAuth": {
      "type": "apiKey",
      "in": "header",
      "name": "app_id"
    },
    "bearerAuth": {
      "name": "Authorization",
      "in": "header",
      "type": "apiKey",
      "description": "JWT Authorization header"
    }
  },
  "security": [{ "ApiKeyAuth": [] }, { "bearerAuth": [] }],
  "tags": [{ "name": "Admins" }, { "name": "Authentification" }],
  "paths": {
      "/api/admins": {
         "get": {
         "tags": ["Admins"],
         "x-swagger-router-controller": "admins",
         "operationId": "getAllAdmins",
         "parameters": [
            {
               "name": "status",
               "in": "query",
               "type": "string",
               "required": false,
               "enum": ["actived", "disabled", "deleted"]
            },
            {
               "name": "role",
               "in": "query",
               "type": "string",
               "required": false,
               "enum": ["Moderateur", "Administrateur", "Comptable"]
            }
            ],
            "responses":{
               "default":{
                  "description":"Unexpected error",
                  "schema":{
                     "$ref":"#/definitions/Error"
                  }
               },
               "200":{
                  "description":"Successful request.",
                  "schema":{
                     "$ref":"#/definitions/getAllAdmins"
                  }
               }
            }
         },
         "post": {
            "tags": ["Admins"],
            "x-swagger-router-controller": "admins",
            "operationId": "postAdmin",
            "parameters": [
              {
                "name": "data",
                "in": "body",
                "description": "Create Admin",
                "required": true,
                "schema": {
                  "$ref": "#/definitions/postAdmin"
                }
              }
            ],
            "responses": {
              "default": {
                "description": "Unexpected error",
                "schema": {
                  "$ref": "#/definitions/Error"
                }
              },
              "201": {
                "description": "Admin Created"
              }
            }
         }
      },
      "/api/admins/{id}":{
        "get":{
           "tags":["Admins"],
           "x-swagger-router-controller":"admins",
           "operationId":"getAdminById",
           "parameters": [
             {
                "name": "id",
                "in":"path",
                "type": "string",
                "required": true
             }
           ],
           "responses":{
              "default":{
                 "description":"Unexpected error",
                 "schema":{
                    "$ref":"#/definitions/Error"
                 }
              },
              "200":{
                 "description":"Successful request.",
                 "schema":{
                    "$ref":"#/definitions/getAdmin"
                 }
              }
           }
        },
        "put":{
           "tags":["Admins"],
           "x-swagger-router-controller":"admins",
           "operationId":"putAdmin",
           "parameters":[
              {
                 "name": "id",
                 "in":"path",
                 "type": "string",
                 "required": true
              },
              {
                 "name":"data",
                 "in":"body",
                 "description":"Update Admin",
                 "required":true,
                 "schema":{
                    "$ref":"#/definitions/putAdmin"
                 }
              }
           ],
           "responses":{
              "default":{
                 "description":"Unexpected error",
                 "schema":{
                    "$ref":"#/definitions/Error"
                 }
              },
              "201":{
                 "description":"Admin Updated",
                 "schema":{
                    "$ref":"#/definitions/Success"
                 }
              }
           }
        },
        "delete":{
           "tags":["Admins"],
           "x-swagger-router-controller":"admins",
           "operationId":"deleteAdmin",
           "parameters": [
             {
                "name": "id",
                "in":"path",
                "type": "string",
                "required": true
             }
           ],
           "responses":{
              "default":{
                 "description":"Unexpected error",
                 "schema":{
                    "$ref":"#/definitions/Error"
                 }
              },
              "201":{
                 "description":"Successful request.",
                 "schema":{
                    "$ref":"#/definitions/Success"
                 }
              }
           }
        }
      },
      "/api/admins/change/password":{
         "put":{
            "tags":["Admins"],
            "x-swagger-router-controller":"admins",
            "operationId":"changePasswordAdmin",
            "parameters":[
               {
                  "name":"data",
                  "in":"body",
                  "description":"Change password Admin",
                  "required":true,
                  "schema":{
                     "$ref":"#/definitions/putPasswordAdmin"
                  }
               }
            ],
            "responses":{
               "default":{
                  "description":"Unexpected error",
                  "schema":{
                     "$ref":"#/definitions/Error"
                  }
               },
               "201":{
                  "description":"Password Updated",
                  "schema":{
                     "$ref":"#/definitions/Success"
                  }
               }
            }
         }
      },
      "/api/admins/{id}/role":{
         "put":{
            "tags":["Admins"],
            "x-swagger-router-controller":"admins",
            "operationId":"putAdmin",
            "parameters":[
               {
                  "name": "id",
                  "in":"path",
                  "type": "string",
                  "required": true
               },
               {
                  "name":"data",
                  "in":"body",
                  "description":"Update Admin role",
                  "required":true,
                  "schema":{
                     "$ref":"#/definitions/putRoleAdmin"
                  }
               }
            ],
            "responses":{
               "default":{
                  "description":"Unexpected error",
                  "schema":{
                     "$ref":"#/definitions/Error"
                  }
               },
               "201":{
                  "description":"Role Updated",
                  "schema":{
                     "$ref":"#/definitions/Success"
                  }
               }
            }
         }
      },
      "/api/admins/{id}/logs":{
         "get":{
            "tags":["Admins"],
            "x-swagger-router-controller":"admins",
            "operationId":"getLogsAdminById",
            "parameters": [
               {
                  "name": "id",
                  "in":"path",
                  "type": "string",
                  "required": true
               },
               {
               "name": "start_date",
               "in":"query",
               "type": "string",
               "required": false
            },
            {
               "name": "end_date",
               "in":"query",
               "type": "string",
               "required": false
            }
            ],
            "responses":{
               "default":{
                  "description":"Unexpected error",
                  "schema":{
                     "$ref":"#/definitions/Error"
                  }
               },
               "200":{
                  "description":"Successful request.",
                  "schema":{
                     "$ref":"#/definitions/getLogsAdmin"
                  }
               }
            }
         },
         "post":{
            "tags":["Admins"],
            "x-swagger-router-controller":"admins",
            "operationId":"postLogAdmin",
            "parameters":[
               {
                  "name": "id",
                  "in":"path",
                  "type": "string",
                  "required": true
               },
               {
                  "name":"data",
                  "in":"body",
                  "description":"Post log Admin",
                  "required":true,
                  "schema":{
                     "$ref":"#/definitions/postLogAdmin"
                  }
               }
            ],
            "responses":{
               "default":{
                  "description":"Unexpected error",
                  "schema":{
                     "$ref":"#/definitions/Error"
                  }
               },
               "201":{
                  "description":"Successful request.",
                  "schema":{
                     "$ref":"#/definitions/Success"
                  }              
               }
            }
         }
      },
      "/api/admins/logs/getAll":{
         "get":{
            "tags":["Admins"],
            "x-swagger-router-controller":"admins",
            "operationId":"getLogsAdmins",
            "parameters": [
               {
                  "name": "start_date",
                  "in":"query",
                  "type": "string",
                  "required": false
               },
               {
                  "name": "end_date",
                  "in":"query",
                  "type": "string",
                  "required": false
               }
            ],
            "responses":{
               "default":{
                  "description":"Unexpected error",
                  "schema":{
                     "$ref":"#/definitions/Error"
                  }
               },
               "200":{
                  "description":"Successful request.",
                  "schema":{
                     "$ref":"#/definitions/getLogsAdmins"
                  }
               }
            }
         }
      },
      "/api/admins/logs/truncate":{
         "delete":{
            "tags":["Admins"],
            "x-swagger-router-controller":"admins",
            "operationId":"truncateLogsAdmins",
            "parameters": [
               {
                  "name": "start_date",
                  "in":"query",
                  "type": "string",
                  "required": false
               },
               {
                  "name": "end_date",
                  "in":"query",
                  "type": "string",
                  "required": false
               }
            ],
            "responses":{
               "default":{
                  "description":"Unexpected error",
                  "schema":{
                     "$ref":"#/definitions/Error"
                  }
               },
               "201":{
                  "description":"Successful request.",
                  "schema":{
                     "$ref":"#/definitions/Success"
                  }
               }
            }
         }
      },
      "/api/auth/login": {
         "post": {
            "tags": ["Authentification"],
            "x-swagger-router-controller": "auth",
            "operationId": "login",
            "parameters": [
              {
                "name": "data",
                "in": "body",
                "description": "Login user",
                "required": true,
                "schema": {
                  "$ref": "#/definitions/loginUser"
                }
              }
            ],
            "responses": {
              "default": {
                "description": "Unexpected error",
                "schema": {
                  "$ref": "#/definitions/Error"
                }
              },
              "201": {
                "description": "User logged",
                "schema": {
                  "$ref": "#/definitions/responseLogin"
                }
              }
            }
         }
      },
      "/api/auth/login/admin": {
         "post": {
            "tags": ["Authentification"],
            "x-swagger-router-controller": "auth",
            "operationId": "loginAmin",
            "parameters": [
              {
                "name": "data",
                "in": "body",
                "description": "Login admin",
                "required": true,
                "schema": {
                  "$ref": "#/definitions/loginUser"
                }
              }
            ],
            "responses": {
              "default": {
                "description": "Unexpected error",
                "schema": {
                  "$ref": "#/definitions/Error"
                }
              },
              "201": {
                "description": "Admin logged",
                "schema": {
                  "$ref": "#/definitions/responseLogin"
                }
              }
            }
         }
      },
      "/api/auth/signup": {
         "post": {
            "tags": ["Authentification"],
            "x-swagger-router-controller": "auth",
            "operationId": "signup",
            "parameters": [
              {
                "name": "data",
                "in": "body",
                "description": "create an account",
                "required": true,
                "schema": {
                  "$ref": "#/definitions/signup"
                }
              }
            ],
            "responses": {
              "default": {
                "description": "Unexpected error",
                "schema": {
                  "$ref": "#/definitions/Error"
                }
              },
              "201": {
                "description": "User created",
                "schema": {
                  "$ref": "#/definitions/Success"
                }
              }
            }
         }
      },
      "/api/auth/forgot": {
         "post": {
            "tags": ["Authentification"],
            "x-swagger-router-controller": "auth",
            "operationId": "forgot",
            "parameters": [
              {
                "name": "data",
                "in": "body",
                "description": "Forgot password",
                "required": true,
                "schema": {
                  "$ref": "#/definitions/forgot"
                }
              }
            ],
            "responses": {
              "default": {
                "description": "Unexpected error",
                "schema": {
                  "$ref": "#/definitions/Error"
                }
              },
              "201": {
                "description": "Forgot your password",
                "schema": {
                  "$ref": "#/definitions/Success"
                }
              }
            }
         }
      },
      "/api/auth/connected": {
         "get": {
            "tags": ["Authentification"],
            "x-swagger-router-controller": "auth",
            "operationId": "connected",
            "parameters": [],
            "responses": {
              "default": {
                "description": "Unexpected error",
                "schema": {
                  "$ref": "#/definitions/Error"
                }
              },
              "201": {
                "description": "get user connected (getAdmin or getUser model)"
              }
            }
         }
      }
   },
  "definitions": {
      "Error": {
         "required": ["message"],
         "properties": {
            "entity": {
               "type": "string"
            },
            "message": {
               "type": "string"
            }
         }
      },
      "Success": {
         "required": ["message"],
         "properties": {
            "entity": {
               "type": "string"
            },
            "message": {
               "type": "string"
            }
         }
      },
      "getAllAdmins": {
         "type": "object",
         "properties": {
            "total_rows": { "type": "integer" },
            "data": {
               "type": "array",
               "items": {
                  "type": "object",
                  "properties": {
                     "id": { "type": "string" },
                     "username": { "type": "string" },
                     "firstname": { "type": "string" },
                     "lastname": { "type": "string" },
                     "email": { "type": "string" },
                     "createdAt": { "type": "string" },
                     "updatedAt": { "type": "string" },
                     "status": {
                        "type": "object",
                        "properties": {
                           "id": { "type": "string" },
                           "label": { "type": "string" },
                           "createdAt": { "type": "string" },
                           "updatedAt": { "type": "string" }
                        }
                     },
                     "role": {
                        "type": "object",
                        "properties": {
                           "id": { "type": "string" },
                           "label": { "type": "string" },
                           "createdAt": { "type": "string" },
                           "updatedAt": { "type": "string" }
                        }
                     }
                  }
               }
            }
         }
      },
      "getAdmin": {
         "type": "object",
         "properties": {
            "id": { "type": "string" },
            "username": { "type": "string" },
            "firstname": { "type": "string" },
            "lastname": { "type": "string" },
            "email": { "type": "string" },
            "createdAt": { "type": "string" },
            "updatedAt": { "type": "string" },
            "status": {
               "type": "object",
               "properties": {
                  "id": { "type": "string" },
                  "label": { "type": "string" },
                  "createdAt": { "type": "string" },
                  "updatedAt": { "type": "string" }
               }
            },
            "role": {
               "type": "object",
               "properties": {
                  "id": { "type": "string" },
                  "label": { "type": "string" },
                  "createdAt": { "type": "string" },
                  "updatedAt": { "type": "string" }
               }
            }
         }
      },
      "postAdmin": {
         "type": "object",
         "properties": {
           "firstName": { "type": "string" },
           "lastName": { "type": "string" },
           "username": { "type": "string" },
           "email": { "type": "string" },
           "role_id": { "type": "string" }
         },
         "required": ["firstName", "lastName", "username", "email", "role_id"],
         "example": {
           "username": "uber",
           "firstname": "Quentin",
           "lastname": "Huber",
           "email": "h.quentin@totoro.fr",
           "role_id": "1dc4364b-d3d1-4db4-a324-a1271e59dfb1"
         }
      },
      "putPasswordAdmin":{
         "type":"object",
         "properties":{
            "old_password":{"type":"string"},
            "password":{"type":"string"}
         },
         "required":["old_password","password"],
         "example":{
            "old_password": "123456",
            "password": "111111"
         }
      },
      "putAdmin":{
         "type":"object",
         "properties":{
            "firstName":{"type":"string"},
            "lastName":{"type":"string"},
            "email":{"type":"string"}
         },
         "required":["firstName","lastName","email"],
         "example":{
            "firstname": "Quentin",
            "lastname": "Huber",
            "email": "h.quentin@totoro.fr"
         }
      },
      "getLogsAdmin":{
         "type":"object",
         "properties":{
            "total_rows": { "type":"integer"},
            "data":{
               "type":"array",
               "items":{
                  "type":"object",
                  "properties":{
                     "id":{ "type":"string"},
                     "table":{"type":"string"},
                     "action":{"type":"string"},
                     "createdAt":{"type":"string"},
                     "updatedAt":{"type":"string"},
                     "admin_id":{"type":"string"}
                  }
               }
            }
         }
      },
      "getLogsAdmins":{
         "type":"object",
         "properties":{
            "total_rows": { "type":"integer"},
            "data":{
               "type":"array",
               "items":{
                  "type":"object",
                  "properties":{
                     "id":{ "type":"string"},
                     "table":{"type":"string"},
                     "action":{"type":"string"},
                     "createdAt":{"type":"string"},
                     "updatedAt":{"type":"string"},
                     "admin": {
                        "type":"object",
                        "properties":{
                           "id":{ "type":"string"},
                           "username":{"type":"string"},
                           "firstname":{"type":"string"},
                           "lastname":{"type":"string"},
                           "email":{"type":"string"},
                           "createdAt":{"type":"string"},
                           "updatedAt":{"type":"string"},
                           "status":{
                              "type":"object",
                              "properties":{
                                 "id": {"type":"string"},
                                 "label": {"type":"string"},
                                 "createdAt": {"type":"string"},
                                 "updatedAt": {"type":"string"}
                              }
                           },
                           "role":{
                                 "type":"object",
                                 "properties":{
                                 "id": {"type":"string"},
                                 "label": {"type":"string"},
                                 "createdAt": {"type":"string"},
                                 "updatedAt": {"type":"string"}
                                 }
                           }  
                        }
                     }
                  }
               }
            }
         }
      },
      "postLogAdmin":{
         "type":"object",
         "properties":{
            "table":{"type":"string"},
            "action":{"type":"string"}
         },
         "required":["table","action"],
         "example":{
            "table": "Users",
            "action": "Deleted"
         }
      },
      "putRoleAdmin":{
         "type":"object",
         "properties":{
            "role_id":{"type":"string"}
         },
         "required":["role_id"],
         "example":{
            "role_id": "1dc4364b-d3d1-4db4-a324-a1271e59dfb1"
         }
      },
      "loginUser":{
         "type":"object",
         "properties":{
            "emailOrUsername":{"type":"string"},
            "password":{"type":"string"}
         },
         "required":["emailOrUsername","password"],
         "example":{
            "emailOrUsername": "admin@test.fr",
            "password": "xxxxxxx"
         }
      },
      "responseLogin":{
         "type":"object",
         "properties":{
            "token":{"type":"string"}
         }
      },
      "forgot":{
         "type":"object",
         "properties":{
            "email":{"type":"string"}
         },
         "required":["email"],
         "example":{
            "email": "test@email.fr"
         }
      },
      "signup":{
         "type":"object",
         "properties":{
            "username":{"type":"string"},
            "firstname":{"type":"string"},
            "lastname":{"type":"string"},
            "email":{"type":"string"},
            "birthday":{"type":"string"},
            "password":{"type":"string"}
         },
         "required":["username","firstname","lastname","email","password"],
         "example":{
            "username": "uber",
            "firstname": "Quentin",
            "lastname": "Huber",
            "email": "h.quentin@totoro.fr",
            "birthday": "2022-12-08",
            "password": "123456"
         }
      }
   }
}
